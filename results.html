<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tulossivu</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" type="image/png" href="Kuvat/palkinto.png">
</head>
<body>
    <header class="hero">
        <img src="Kuvat/palkinto.png" alt="logo" class="heropic">
        <h1>Dokathlon 2024</h1>
    </header>
    <nav>
        <a href="index.html">Kotisivu</a>
        <a href="about.html">Infosivu</a>
        <a href="history.html">Historia</a>
        <a href="ranking.html">P4P ranking</a>
        <a href="results.html">Tulokset</a>
    </nav>
    <div class="container">
        <div class="content">
            <h2>Tulokset</h2>

            <div class="results-table">
                <table id="eventResultsTable">
                    <thead>
                        <!-- Table headers will be inserted here dynamically -->
                    </thead>
                    <tbody>
                        <!-- Data will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Dokathlon. Kaikki oikeudet pidätetään.</p>
    </footer>

    <script>
        const API_KEY = 'AIzaSyDD90a2fkngn3OCYwJpijcZtyWwohmWJ8Q'; // Replace with your actual API key
        const SHEET_ID = '1VmCpTWbrkG5XXCjxoXsAb6mGIcIVIrlj4e-YrnmSwq4'; // Replace with your actual sheet ID
        const rangesA1 = ['Taulukko1!A1:J1', 'Taulukko1!A2:J20']; // Adjust ranges based on your needs

        async function fetchData() {
            try {
                // Join ranges for API call
                const rangeParams = rangesA1.map(range => `ranges=${encodeURIComponent(range)}`).join('&');
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values:batchGet?${rangeParams}&key=${API_KEY}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`Error: ${response.status} ${response.statusText}`);
                }

                const data = await response.json();
                if (data && data.valueRanges) {
                    return data.valueRanges;
                } else {
                    throw new Error('No data found or data structure is incorrect.');
                }
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function populateTable(data) {
            if (!data || data.length === 0) {
                console.error('No data available to populate the table.');
                return;
            }

            const tableHead = document.querySelector('#eventResultsTable thead');
            const tableBody = document.querySelector('#eventResultsTable tbody');

            // Create table headers from the first range
            const headers = data[0].values[0]; // First row contains headers
            const headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            tableHead.appendChild(headerRow);

            // Create table rows from the subsequent ranges
            data.forEach((range, index) => {
                if (index === 0) return; // Skip the first range which is used for headers
                range.values.slice(1).forEach(row => { // Skip the first row (headers)
                    const rowElement = document.createElement('tr');
                    row.forEach(cell => {
                        const cellElement = document.createElement('td');
                        cellElement.textContent = cell;
                        rowElement.appendChild(cellElement);
                    });
                    tableBody.appendChild(rowElement);
                });
            });
        }

        fetchData().then(data => {
            populateTable(data);
        }).catch(error => {
            console.error('Error processing data:', error);
        });
    </script>
</body>
</html>
